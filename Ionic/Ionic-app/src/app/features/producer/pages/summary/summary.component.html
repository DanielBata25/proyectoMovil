<ion-content fullscreen class="page-bg summary-content">
  <div class="page-shell product-shell summary-shell">
    <!-- Perfil del productor -->
    <section class="profile-section">
       <br>
      <h2 class="section-title">Resumen</h2>
      <p class="subtext">
        Vista general de tu desempeño como productor. Usa las tarjetas para navegar a
        la lista filtrada.
      </p>

      <div class="profile-buttons">
        <app-button
          color="secondary"
          [text]="'Ver mi perfil'"
          icon="person-circle-outline"
          (clicked)="goProfile()">
        </app-button>
      </div>
    </section>

    <section class="stock-section">
      <div class="low-stock" *ngIf="loadingLowStock">
        <p class="low-stock__title">Cargando alertas de stock...</p>
      </div>

      <div class="low-stock low-stock--error" *ngIf="!loadingLowStock && errorLoadingLowStock">
        <p class="low-stock__title">No pudimos cargar los productos con poco stock.</p>
      </div>

      <div
        class="low-stock"
        *ngIf="!loadingLowStock && !errorLoadingLowStock && lowStockProducts.length">
        <div class="low-stock__header">
          <p class="low-stock__title">Productos con poco stock</p>
          <span class="low-stock__badge">{{ lowStockProducts.length }}</span>
        </div>
        <p class="low-stock__subtitle">
          Revisa y actualiza el stock para evitar quedarte sin unidades.
        </p>
        <ul class="low-stock__list">
          <li *ngFor="let product of lowStockProducts">
            <div>
              <p class="low-stock__name">{{ product.name }}</p>
              <span class="low-stock__stock">Stock actual: {{ product.stock }}</span>
            </div>
            <a
              class="low-stock__link"
              [routerLink]="['/account/producer/product/update', product.id]">
              Actualizar
            </a>
          </li>
        </ul>
      </div>
    </section>

    <!-- Estado de los pedidos -->
    <section class="orders-section">
      <header class="section-header">
        <h2 class="subtitle">Estado de los pedidos</h2>
        <div class="order-actions">
        <app-button
          class="order-btn btn-inline"
          color="secondary"
          [text]="'Ver pendientes'"
          type="button"
          (clicked)="goToOrders('pending')">
        </app-button>
        <app-button
          class="order-btn btn-inline"
          color="secondary"
          [text]="'Ver todos'"
          type="button"
          (clicked)="goToOrders('all')">
        </app-button>
        </div>
      </header>
      <p class="text">Resumen rápido de pedidos totales y pendientes.</p>

      <div class="cont-stat-card">
        <app-stat-card
          icon="inventory_2"
          text="Total pedidos"
          [count]="totalOrders"
          color="info"
          [loading]="loading"
          [clickable]="true"
          [to]="['/account/producer/orders']"
          [queryParams]="{ status: 'all' }">
        </app-stat-card>

        <app-stat-card
          icon="hourglass_empty"
          text="Pendientes"
          [count]="pendingOrders"
          color="warning"
          [loading]="loading"
          [clickable]="true"
          [to]="['/account/producer/orders']"
          [queryParams]="{ status: 'pending' }">
        </app-stat-card>
      </div>
    </section>

    <!-- Filtros de tiempo -->
    <section class="time-filters-section">
      <ion-segment [value]="range" (ionChange)="onRangeChange($event)" scrollable="true">
        <ion-segment-button value="day">
          <ion-label>Día</ion-label>
        </ion-segment-button>
        <ion-segment-button value="week">
          <ion-label>Semana</ion-label>
        </ion-segment-button>
        <ion-segment-button value="month">
          <ion-label>Mes</ion-label>
        </ion-segment-button>
      </ion-segment>
    </section>

    <!-- Productos más vendidos -->
    <section class="products-section">
      <header class="section-header">
        <h2 class="subtitle">Productos más vendidos</h2>
      </header>
      <p class="text">
        Productos con mayor número de pedidos completados. Útil para priorizar
        inventario y promoción.
      </p>

      <div class="orders-header">
        <div>
          <p class="orders-caption">Pedidos totales</p>
          <h3 class="orders-total">{{ totalOrders }}</h3>
          <p class="orders-delta">Este {{ rangeLabel }} <span class="positive">+15%</span></p>
        </div>
      </div>

      <div class="chart-card" *ngIf="!chartLoading; else chartSkeleton">
        <canvas
          baseChart
          [data]="barChartData"
          [options]="barChartOptions"
          [type]="'bar'">
        </canvas>
      </div>
      <ng-template #chartSkeleton>
        <div class="chart-card chart-card--loading">
          <ion-skeleton-text animated style="height: 180px"></ion-skeleton-text>
        </div>
      </ng-template>
    </section>
  </div>
</ion-content>
