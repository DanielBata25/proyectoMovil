<ion-content class="product-content" fullscreen>
  <div class="page-shell">
    <!-- Botón Crear Producto -->
    <section class="product-actions">
      <ion-button expand="block" color="success" fill="solid" (click)="createProduct()">
        <ion-icon slot="start" name="add-circle-outline"></ion-icon>
        Crear Producto
      </ion-button>
    </section>

    <!-- Listado de productos -->
    <ng-container *ngIf="!loading && paginatedProducts.length; else emptyState">
      <ion-grid class="product-grid">
        <ion-row>
          <ion-col size="6" *ngFor="let product of paginatedProducts; trackBy: trackById">
            <ion-card class="product-card" (click)="viewProduct(product)">
              <div class="image-wrap">
                <ion-img
                  [src]="getCover(product) || 'assets/1.png'"
                  [alt]="product.name">
                </ion-img>
              </div>

              <ion-card-content class="content">
                <h3 class="title">{{ product.name }}</h3>

                <div class="row muted">
                  <ion-icon name="person-outline"></ion-icon>
                  <span>{{ product.personName || product.producerCode || '--' }}</span>
                </div>

                <div class="row muted">
                  <ion-icon name="location-outline"></ion-icon>
                  <span>{{ product.cityName || '--' }}, {{ product.departmentName || '--' }}</span>
                </div>

                <div class="price">
                  {{ product.price | currency:'COP':'symbol':'1.0-0':'es-CO' }}
                </div>
              </ion-card-content>

              <!-- Acciones -->
              <div class="card-actions" (click)="$event.stopPropagation()">
                <ion-button fill="clear" color="success" aria-label="Editar" (click)="onEdit(product)">
                  <ion-icon slot="icon-only" name="create-outline"></ion-icon>
                </ion-button>
                <ion-button fill="clear" color="primary" aria-label="Ver" (click)="viewProduct(product)">
                  <ion-icon slot="icon-only" name="cube-outline"></ion-icon>
                </ion-button>
                <ion-button fill="clear" color="danger" aria-label="Eliminar" (click)="onDelete(product)">
                  <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                </ion-button>
              </div>

              <div class="accent-bar"></div>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- Controles de paginación (fijos abajo) -->
      <div class="pagination-container" *ngIf="totalPages > 1">
        <div class="pagination">
          <ion-button fill="clear" size="small" (click)="prevPage()" [disabled]="page === 1">
            <ion-icon slot="icon-only" name="chevron-back-outline"></ion-icon>
          </ion-button>
          <span>{{ page }} / {{ totalPages }}</span>
          <ion-button fill="clear" size="small" (click)="nextPage()" [disabled]="page === totalPages">
            <ion-icon slot="icon-only" name="chevron-forward-outline"></ion-icon>
          </ion-button>
        </div>
      </div>
    </ng-container>

    <!-- Estado vacío o cargando -->
    <ng-template #emptyState>
      <div class="empty">
        <ion-icon name="layers-outline"></ion-icon>
        <p *ngIf="!loading">No tienes productos todavía.</p>
        <p *ngIf="loading">Cargando productos...</p>
        <ion-button fill="clear" size="small" (click)="createProduct()">
          Crear el primero
        </ion-button>
      </div>
    </ng-template>
  </div>
</ion-content>
