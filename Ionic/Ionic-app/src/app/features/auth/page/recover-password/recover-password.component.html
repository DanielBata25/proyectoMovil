<ion-content
  class="auth-content safe-page full-viewport"
  [style.background-image]="'url(assets/backgrounds/fondologin.jpg)'"
  style="background-size:cover;background-position:center;--background:transparent"
>
  <!-- Contenedor centrado + logo superior -->
  <div class="auth-viewport">
    <img src="assets/logo/logo.png" alt="Logo" class="brand-logo" />

    <!-- Tarjeta -->
    <div class="auth-card">

      <!-- Paso 1 -->
      <form *ngIf="step() === 1" [formGroup]="s1" (ngSubmit)="sendCode()">
        <h1 class="hero-title">Recuperar<br />Contraseña</h1>

        <label for="email1" class="form-label">Correo electrónico</label>
        <ion-input
          id="email1"
          type="email"
          formControlName="email"
          class="input-custom"
          placeholder="Ejemplo@gmail.com">
        </ion-input>
        <ion-note color="danger" class="small"
                  *ngIf="s1.get('email')?.invalid && s1.get('email')?.touched">
          {{ getErrorMessage('step1','email') }}
        </ion-note>

        <app-button
          class="full-width mt-3"
          type="submit"
          color="primary"
          [disabled]="s1.invalid || loading()"
          text="Enviar código de recuperación">
        </app-button>

        <app-button
          class="full-width mt-2"
          type="button"
          color="secondary"
          redirectTo="/auth/login"
          text="Volver al login">
        </app-button>
      </form>

      <!-- Paso 2 -->
      <form *ngIf="step() === 2" [formGroup]="s2" (ngSubmit)="confirm()">
        <h2 class="panel-title">Confirmar código y nueva contraseña</h2>

        <label for="email2" class="form-label">Confirmar correo</label>
        <ion-input
          id="email2"
          type="email"
          formControlName="emailConfirm"
          class="input-custom"
          placeholder="Ejemplo@gmail.com">
        </ion-input>
        <ion-note color="danger" class="small"
                  *ngIf="s2.get('emailConfirm')?.invalid && s2.get('emailConfirm')?.touched">
          {{ getErrorMessage('step2','emailConfirm') }}
        </ion-note>
        <ion-note color="danger" class="small"
                  *ngIf="s2.get('emailConfirm')?.touched && !sameEmail()">
          El correo debe coincidir con el del Paso 1.
        </ion-note>

        <label for="code" class="form-label mt-3">Código</label>
        <ion-input
          id="code"
          type="text"
          formControlName="code"
          class="input-custom"
          placeholder="Código recibido">
        </ion-input>
        <ion-note color="danger" class="small"
                  *ngIf="s2.get('code')?.invalid && s2.get('code')?.touched">
          {{ getErrorMessage('step2','code') }}
        </ion-note>

        <label for="newPassword" class="form-label mt-3">Nueva contraseña</label>
        <ion-input
          id="newPassword"
          type="password"
          formControlName="newPassword"
          class="input-custom"
          placeholder="Nueva contraseña">
        </ion-input>
        <ion-note color="danger" class="small"
                  *ngIf="(s2.get('newPassword')?.invalid && s2.get('newPassword')?.touched) || s2.hasError('passwordMismatch')">
          {{ getErrorMessage('step2','newPassword') }}
        </ion-note>

        <label for="confirmNewPassword" class="form-label mt-3">Confirmar contraseña</label>
        <ion-input
          id="confirmNewPassword"
          type="password"
          formControlName="confirmNewPassword"
          class="input-custom"
          placeholder="Confirmar contraseña">
        </ion-input>
        <ion-note color="danger" class="small"
                  *ngIf="(s2.get('confirmNewPassword')?.invalid && s2.get('confirmNewPassword')?.touched) || s2.hasError('passwordMismatch')">
          {{ getErrorMessage('step2','confirmNewPassword') }}
        </ion-note>

        <app-button
          class="full-width mt-4"
          type="submit"
          color="primary"
          [disabled]="s2.invalid || !sameEmail() || loading()"
          text="Confirmar y cambiar contraseña">
        </app-button>

        <app-button
          class="full-width mt-2"
          type="button"
          color="secondary"
          (clicked)="goBackToStep1()"
          text="Volver">
        </app-button>
      </form>

    </div>
  </div>
</ion-content>
