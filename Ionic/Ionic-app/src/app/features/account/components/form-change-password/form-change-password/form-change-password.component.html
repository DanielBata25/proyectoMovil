<ion-content [fullscreen]="true" class="page-bg">
  <div class="page-container">
    <ion-card class="form-card">
      <ion-card-header>
        <ion-card-title>{{ title }}</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <form [formGroup]="form" (ngSubmit)="save()">

        <!-- Contraseña actual -->
        <ion-item>
          <ion-label position="floating">Contraseña actual</ion-label>
          <ion-input
            formControlName="currentPassword"
            [type]="showCurrent ? 'text' : 'password'"
            placeholder="Ingresa tu contraseña actual">
          </ion-input>
          <ion-icon slot="end"
                    [name]="showCurrent ? 'eye-off' : 'eye'"
                    (click)="toggle('current')"></ion-icon>
        </ion-item>
        <div class="error" *ngIf="f.currentPassword.invalid && f.currentPassword.touched">
          La contraseña actual es obligatoria
        </div>

        <!-- Nueva contraseña -->
        <ion-item>
          <ion-label position="floating">Nueva contraseña</ion-label>
          <ion-input
            formControlName="newPassword"
            [type]="showNew ? 'text' : 'password'"
            placeholder="Ingresa tu nueva contraseña">
          </ion-input>
          <ion-icon slot="end"
                    [name]="showNew ? 'eye-off' : 'eye'"
                    (click)="toggle('new')"></ion-icon>
        </ion-item>
        <div class="error" *ngIf="f.newPassword.hasError('required') && f.newPassword.touched">
          La nueva contraseña es obligatoria
        </div>
        <div class="error" *ngIf="f.newPassword.hasError('passwordPolicy') && f.newPassword.touched">
          Debe tener al menos 6 caracteres y una mayúscula
        </div>

        <!-- Confirmar contraseña -->
        <ion-item>
          <ion-label position="floating">Confirmar nueva contraseña</ion-label>
          <ion-input
            formControlName="confirmNewPassword"
            [type]="showConfirm ? 'text' : 'password'"
            placeholder="Confirma tu nueva contraseña">
          </ion-input>
          <ion-icon slot="end"
                    [name]="showConfirm ? 'eye-off' : 'eye'"
                    (click)="toggle('confirm')"></ion-icon>
        </ion-item>
        <div class="error" *ngIf="f.confirmNewPassword.hasError('required') && f.confirmNewPassword.touched">
          La confirmación es obligatoria
        </div>
        <div class="error" *ngIf="form.hasError('passwordMismatch') && f.confirmNewPassword.touched">
          Las contraseñas no coinciden
        </div>

        <!-- Botones -->
        <div class="form-actions">
          <ion-button expand="block" type="submit" [disabled]="form.invalid" color="success">
            <ion-icon slot="start" name="save"></ion-icon>
            Actualizar contraseña
          </ion-button>

          <ion-button expand="block" color="medium" (click)="goBack()">
            <ion-icon slot="start" name="close"></ion-icon>
            Cancelar
          </ion-button>
        </div>

        <!-- Nota -->
        <p class="note">Asegúrate de usar una contraseña segura.</p>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
