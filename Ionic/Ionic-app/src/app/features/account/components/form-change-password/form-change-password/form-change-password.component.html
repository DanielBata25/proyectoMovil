<ion-content [fullscreen]="true" class="page-bg">
  <div class="page-shell page-shell--center">
    <div class="page-topbar">
    </div>
    <ion-card class="form-card">
      <ion-card-header>
        <ion-card-title>{{ title }}</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <form [formGroup]="form" (ngSubmit)="save()">

        <!-- Contraseña actual -->
        <ion-item>
          <ion-label position="floating">Contraseña actual</ion-label>
          <ion-input
            formControlName="currentPassword"
            [type]="showCurrent ? 'text' : 'password'">
          </ion-input>
          <ion-icon slot="end"
                    [name]="showCurrent ? 'eye-off' : 'eye'"
                    (click)="toggle('current')"></ion-icon>
        </ion-item>
        <div class="error" *ngIf="f.currentPassword.invalid && f.currentPassword.touched">
          La contraseña actual es obligatoria
        </div>

        <!-- Nueva contraseña -->
        <ion-item>
          <ion-label position="floating">Nueva contraseña</ion-label>
          <ion-input
            formControlName="newPassword"
            [type]="showNew ? 'text' : 'password'">
          </ion-input>
          <ion-icon slot="end"
                    [name]="showNew ? 'eye-off' : 'eye'"
                    (click)="toggle('new')"></ion-icon>
        </ion-item>
        <div class="error" *ngIf="f.newPassword.hasError('required') && f.newPassword.touched">
          La nueva contraseña es obligatoria
        </div>
        <div class="error" *ngIf="f.newPassword.hasError('passwordPolicy') && f.newPassword.touched">
          Debe tener al menos 6 caracteres y una mayúscula
        </div>

        <!-- Confirmar contraseña -->
        <ion-item>
          <ion-label position="floating">Confirmar nueva contraseña</ion-label>
          <ion-input
            formControlName="confirmNewPassword"
            [type]="showConfirm ? 'text' : 'password'">
            <!-- placeholder="Confirma tu nueva contraseña" -->
          </ion-input>
          <ion-icon slot="end"
                    [name]="showConfirm ? 'eye-off' : 'eye'"
                    (click)="toggle('confirm')"></ion-icon>
        </ion-item>
        <div class="error" *ngIf="f.confirmNewPassword.hasError('required') && f.confirmNewPassword.touched">
          La confirmación es obligatoria
        </div>
        <div class="error" *ngIf="form.hasError('passwordMismatch') && f.confirmNewPassword.touched">
          Las contraseñas no coinciden
        </div>

        <!-- Botones -->
        <div class="form-actions">
          <app-button
            [text]="'Actualizar contraseña'"
            icon="save"
            color="primary"
            type="submit"
            [disabled]="form.invalid">
          </app-button>

          <app-button
            color="secondary"
            icon="close"
            [text]="'Cancelar'"
            type="button"
            (clicked)="goBack()">
          </app-button>
        </div>

        <!-- Nota -->
        <p class="note">Asegúrate de usar una contraseña segura.</p>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
