<ion-card
  class="product-card"
  [class.product-card--loading]="loading"
  [attr.role]="loading ? 'presentation' : 'button'"
  [attr.tabindex]="loading ? -1 : 0"
  (click)="!loading && onDetail(product)"
  (keyup.enter)="!loading && onDetail(product)"
  (keyup.space)="!loading && onDetail(product); $event.preventDefault()"
  [attr.aria-label]="loading ? undefined : 'Abrir detalle del producto'"
>
  <!-- Imagen -->
  <div class="image-wrap">
    <ng-container *ngIf="!loading; else skeletonImg">
      <img
        class="card-image"
        [src]="imageUrl"
        alt="Imagen del producto"
        loading="lazy"
        decoding="async"
        (error)="onImgError($event)"
      />
    </ng-container>
    <ng-template #skeletonImg>
      <ion-skeleton-text animated class="card-image skeleton-box"></ion-skeleton-text>
    </ng-template>
  </div>

  <ion-card-content class="content">
    <ng-container *ngIf="!loading; else skeletonContent">
      <h3 class="title line-2" [title]="product.name">{{ product.name }}</h3>

      <p class="info-row">
        <ion-icon name="person-outline" aria-hidden="true"></ion-icon>
        <span>{{ product.personName }}</span>
      </p>

      <p class="info-row">
        <ion-icon name="location-outline" aria-hidden="true"></ion-icon>
        <span>{{ product.cityName }}, {{ product.departmentName }}</span>
      </p>

      <p class="price">
        ${{ product.price | number:'1.0-0' }}
      </p>

      <div *ngIf="showActions" class="actions">
        <ion-button fill="clear" size="small" color="primary" (click)="onViewClick($event)" aria-label="Ver producto">
          <ion-icon class="icon-view" name="eye-outline"></ion-icon>
        </ion-button>

        <ion-button fill="clear" size="small" (click)="onEditClick($event)" aria-label="Editar producto">
          <ion-icon class="icon-edit" name="create-outline"></ion-icon>
        </ion-button>

        <ion-button fill="clear" size="small" color="danger" (click)="onDeleteClick($event)" aria-label="Eliminar producto">
          <ion-icon class="icon-delete" name="trash-outline"></ion-icon>
        </ion-button>
      </div>
    </ng-container>

    <ng-template #skeletonContent>
      <ion-skeleton-text animated style="width: 80%; height: 18px; margin-bottom: 8px;"></ion-skeleton-text>
      <ion-skeleton-text animated style="width: 70%; height: 14px; margin-bottom: 6px;"></ion-skeleton-text>
      <ion-skeleton-text animated style="width: 60%; height: 14px; margin-bottom: 6px;"></ion-skeleton-text>
      <ion-skeleton-text animated style="width: 40%; height: 16px;"></ion-skeleton-text>
    </ng-template>
  </ion-card-content>
</ion-card>
